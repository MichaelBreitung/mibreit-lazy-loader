var n=Object.defineProperty;var h=(e,t,s)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var a=(e,t,s)=>h(e,typeof t!="symbol"?t+"":t,s);import{getAttribute as r,getCssClasses as m,setAttribute as c,removeCssClass as l,removeAttribute as L,addCssStyle as S,addCssClass as u,removeCssStyle as C}from"../node_modules/mibreit-dom-tools/lib/index.js";const _="mbll__marker",d="mbll__transition",o="data-src",A="src";class T{constructor(t){a(this,"_element");a(this,"_state",0);a(this,"_wasLoadedCallbacks",new Array);a(this,"_dataSrc",null);var i;this._element=t,this._dataSrc=r(t,o);const s=(i=m(t))==null?void 0:i.split(",");this._dataSrc||s&&s.includes(_)?(this._state=0,this._setBaseStyle()):this._state=2}load(){return new Promise((t,s)=>{this._state==0?(this._element.onload=()=>{this._finishLoad(),t(!0)},this._triggerLoad(),this._state=1,this._setLoadingStyle(),this._element instanceof HTMLImageElement&&this._element.complete&&(this._element.onload=null,this._finishLoad(),t(!0))):this._state===1?s(!1):s(!0)})}wasLoaded(){return this._state===2}addWasLoadedCallback(t){this._wasLoadedCallbacks.includes(t)||this._wasLoadedCallbacks.push(t)}_triggerLoad(){this._dataSrc&&c(this._element,A,this._dataSrc),l(this._element,_)}_finishLoad(){L(this._element,o),this._state=2,this._wasLoadedCallbacks.forEach(t=>{t()}),setTimeout(()=>{this._setLoadedStyle()},50)}_setBaseStyle(){S(this._element,"opacity","0")}_setLoadingStyle(){u(this._element,d)}_setLoadedStyle(){C(this._element,"opacity"),setTimeout(()=>{l(this._element,d)},1e3)}}export{T as default};
